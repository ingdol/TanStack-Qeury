# 5. useQuery

[GitHub - ssi02014/react-query-tutorial: ðŸ˜ƒ TanStack Query(aka. react query) ì—ì„œ ìžì£¼ ì‚¬ìš©ë˜ëŠ” ê°œë… ì •ë¦¬](https://github.com/ssi02014/react-query-tutorial?tab=readme-ov-file#usequery)

# useQuery ê¸°ë³¸ ë¬¸ë²•

- `v5` ë¶€í„° ì¸ìžë¡œ ë‹¨ í•˜ë‚˜ì˜ `ê°ì²´` ë§Œ ë°›ìŒ
  - `queryKey` , `queryFn` : ì²« ë²ˆì§¸ ì¸ìžì´ìž í•„ìˆ˜ ê°’

```jsx
const result = useQuery({
  queryKey, // required
  queryFn, // required
  // ...options ex) gcTime, staleTime, select, ...
});

result.data;
result.isLoading;
result.refetch;
// ...
```

```jsx
// ì‹¤ì œ ì˜ˆì œ
const getRepos = async () => {
  return await axios.get(
    'https://api.github.com/repos/tannerlinsley/react-query'
  );
};

const { data } = useQuery({
  queryKey: ['repoData'],
  queryFn: getRepos,
});
```

## 1. queryKey

```tsx
// (1) queryKeyëŠ” ë°ì´í„°ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„ì— ë”í•´ ì¿¼ë¦¬ í•¨ìˆ˜ì— ì•„ëž˜ì™€ ê°™ì´ íŽ¸ë¦¬í•˜ê²Œ ì „ë‹¬í•  ìˆ˜ ìžˆìŒ

export const getUserInfo = async ({ queryKey }) => {
  const userId = queryKey[1]; // ['user-info', '1']
  const response = await axios.get(
    `https://jsonplaceholder.typicode.com/users/${userId}`
  );
  return response?.data;
};

export const useUserInfoData = (userId) => {
  return useQuery({
    queryKey: ['user-info', userId],
    queryFn: getUserInfo,
  });
};
```

```tsx
// ì „ì²´ ì‹¤í–‰ ì½”ë“œ

import { useQuery } from '@tanstack/react-query';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import axios from 'axios';

const queryClient = new QueryClient();

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <ReactQueryDevtools initialIsOpen={false} />
      <Example />
    </QueryClientProvider>
  );
}

function Example() {
  const { data } = useUserInfoData(1);
  return <div>{data?.id}</div>;
}

export const getUserInfo = async ({ queryKey }) => {
  const userId = queryKey[1];
  const response = await axios.get(
    `https://jsonplaceholder.typicode.com/users/${userId}`
  );
  return response?.data;
};

export const useUserInfoData = (userId) => {
  return useQuery({
    queryKey: ['user-info', userId],
    queryFn: getUserInfo,
  });
};
```

- useQueryì˜ queryKeyëŠ” `ë°°ì—´` ë¡œ ì§€ì •í•´ì¤˜ì•¼ í•¨
  - ë‹¨ì¼ ë¬¸ìžì—´ë§Œ í¬í•¨ëœ ë°°ì—´ì´ ë  ìˆ˜ë„ ìžˆê³ , ì—¬ëŸ¬ ë¬¸ìžì—´ê³¼ ì¤‘ì²©ëœ ê°ì²´ë¡œ êµ¬ì„±ëœ ë³µìž¡í•œ í˜•íƒœì¼ ìˆ˜ ìžˆìŒ

```tsx
// An individual todo
useQuery({ queryKey: ["todo", 5], ... })

// An individual todo in a "preview" format
useQuery({ queryKey: ["todo", 5, { preview: true }], ...})
```

- useQueryëŠ” `queryKey` ë¥¼ ê¸°ë°˜ìœ¼ë¡œ `ì¿¼ë¦¬ ìºì‹±` ì„ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•µì‹¬ìž„
  - ë§Œì•½, ì¿¼ë¦¬ê°€ íŠ¹ì • ë³€ìˆ˜ì— `ì˜ì¡´` í•œë‹¤ë©´ ë°°ì—´ì—ë‹¤ ì´ì–´ì„œ ì¤˜ì•¼ í•¨
    - ex ) ['user-info', userId, â€¦ ]
  - ì´ëŠ” ì‚¬ì‹¤ êµ‰ìž¥ížˆ ì¤‘ìš”í•¨. ì˜ˆë¥¼ ë“¤ì–´, `queryClient.setQueryData` ë“±ê³¼ ê°™ì´ íŠ¹ì • ì¿¼ë¦¬ì— ì ‘ê·¼ì´ í•„ìš”í•  ë•Œ `ì´ˆê¸°ì— ì„¤ì •í•´ë‘” í¬ë§·` ì„ ì§€ì¼œì¤˜ì•¼ ì œëŒ€ë¡œ ì¿¼ë¦¬ì— ì ‘ê·¼í•  ìˆ˜ ìžˆìŒ
  - ì•„ëž˜ options ì˜ˆì œë¥¼ ì‚´íŽ´ë³´ë©´ useSuperHerorDataì˜ queryKeyëŠ” `['user-info', userId]` ìž„, ê·¸ë ‡ë‹¤ë©´ queryClient.setQueryDataë¥¼ ì´ìš©í•  ë•Œ ë˜‘ê°™ì´ `['user-info', userId]` í¬ë§·ì„ ê°€ì ¸ì•¼ í•¨. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì›í•˜ëŠ” ì¿¼ë¦¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ

## 2. queryFn

- useQueryì˜ queryFnì€ `Promise` ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë„£ì–´ì•¼ í•¨

```tsx
// (2) ìƒë‹¨ì˜ queryKey ì˜ˆì œì™€ ë°˜ëŒ€ë¡œ queryFn ìžì²´ì ìœ¼ë¡œ ì¸ìžë¥¼ ë°›ëŠ” í˜•íƒœ

export const getUserInfo = async (userId) => {
  const response = await axios.get(
    `https://jsonplaceholder.typicode.com/users/${userId}`
  );
  return response?.data;
};

export const useUserInfoData = (userId) => {
  return useQuery({
    queryKey: ['user-info', userId],
    queryFn: () => getUserInfo(userId),
  });
};
```

## 3. options

[useQuery | TanStack Query Docs](https://tanstack.com/query/v5/docs/framework/react/reference/useQuery)

```tsx
export const useUserInfoData = (userId) => {
  return useQuery({
    queryKey: ['user-info', userId],
    queryFn: () => getUserInfo(userId),
    gcTime: 5 * 60 * 1000, // 5ë¶„
    staleTime: 1 * 60 * 1000, // 1ë¶„
    retry: 1,
    // ... options
  });
};
```
